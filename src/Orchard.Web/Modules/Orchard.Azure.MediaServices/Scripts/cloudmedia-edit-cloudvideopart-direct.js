/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/// <reference path="Typings/jquery.d.ts" />
/// <reference path="Typings/jqueryui.d.ts" />
/// <reference path="Typings/moment.d.ts" />
var Orchard;
(function (Orchard) {
    var Azure;
    (function (Azure) {
        var MediaServices;
        (function (MediaServices) {
            var CloudVideoEdit;
            (function (CloudVideoEdit) {
                var requiredUploads;
                function uploadCompleted(sender, e, data) {
                    var scope = $(sender).closest(".async-upload");
                    var status = data.errorThrown && data.errorThrown.length > 0 ? data.errorThrown : data.textStatus;
                    scope.find(".progress-bar").hide();
                    scope.find(".progress-text").hide();
                    scope.find(".progress-details").hide();
                    scope.find(".status.preparing").hide();
                    scope.find(".status.uploading").hide();
                    switch (status) {
                        case "error":
                            cleanup(scope, data);
                            alert("The upload of the selected file failed. You may try again after the cleanup has finished.");
                            return;
                        case "abort":
                            cleanup(scope, data);
                            return;
                    }
                    var editedFileName = scope.find("input[name$='.FileName']").val();
                    var statusUploaded = scope.find(".status.uploaded").show();
                    statusUploaded.text(statusUploaded.data("text-template").replace("{filename}", editedFileName));
                    scope.data("upload-isactive", false);
                    scope.data("upload-iscompleted", true);
                    scope.data("upload-start-time", null);
                }
                function cleanup(scope, data) {
                    var wamsAssetInput = scope.find("input[name$='.WamsAssetId']");
                    var fileNameInput = scope.find("input[name$='.FileName']");
                    var assetId = $.trim(wamsAssetInput.val());
                    var fileUploadWrapper = data.fileInput.closest(".file-upload-wrapper");
                    if (assetId.length > 0) {
                        var url = scope.data("delete-asset-url");
                        var antiForgeryToken = scope.closest("form").find("[name='__RequestVerificationToken']").val();
                        var cleanupMessage = scope.find(".status.cleanup");
                        wamsAssetInput.val("");
                        fileNameInput.val("");
                        cleanupMessage.show();
                        $.ajax({
                            url: url,
                            type: "DELETE",
                            data: {
                                id: assetId,
                                __RequestVerificationToken: antiForgeryToken
                            }
                        }).done(function () {
                            scope.data("upload-isactive", false);
                            scope.data("upload-start-time", null);
                            scope.find(".file-upload-wrapper").show();
                            cleanupMessage.hide();
                        }).fail(function () {
                            alert("An error occurred on the server while trying to clean up.");
                        });
                    }
                    fileUploadWrapper.show();
                }
                function pad(value, length) {
                    var str = value.toString();
                    while (str.length < length) {
                        str = "0" + str;
                    }
                    return str;
                }
                function createBlockId(blockIndex) {
                    var blockIdPrefix = "block-";
                    return btoa(blockIdPrefix + pad(blockIndex, 6));
                }
                function commitBlockList(scope, data) {
                    var deferred = $.Deferred();
                    var blockIds = scope.data("block-ids");
                    if (blockIds.length == 0) {
                        // The file was uploaded as a whole, so no manifest to submit.
                        deferred.resolve();
                    }
                    else {
                        // The file was uploaded in chunks.
                        var url = scope.data("sas-locator") + "&comp=blocklist";
                        var requestData = '<?xml version="1.0" encoding="utf-8"?><BlockList>';
                        for (var i = 0; i < blockIds.length; i++) {
                            requestData += '<Latest>' + blockIds[i] + '</Latest>';
                        }
                        requestData += '</BlockList>';
                        $.ajax({
                            url: url,
                            type: "PUT",
                            data: requestData,
                            contentType: "text/plain; charset=UTF-8",
                            crossDomain: true,
                            cache: false,
                            beforeSend: function (xhr) {
                                xhr.setRequestHeader('x-ms-date', new Date().toUTCString());
                                xhr.setRequestHeader('x-ms-blob-content-type', data.files[0].type);
                                xhr.setRequestHeader('x-ms-version', "2012-02-12");
                                xhr.setRequestHeader('Content-Length', requestData.length.toString());
                            },
                            success: function () {
                                deferred.resolve(data);
                            },
                            error: function (xhr, status, error) {
                                data.textStatus = status;
                                data.errorThrown = error;
                                deferred.fail(data);
                            }
                        });
                    }
                    return deferred.promise();
                }
                function hasActiveUploads() {
                    var scope = $(".upload-direct");
                    var flag = false;
                    scope.find(".async-upload").each(function () {
                        if ($(this).data("upload-isactive") == true) {
                            flag = true;
                            return false;
                        }
                    });
                    return flag;
                }
                function hasCompletedUploads() {
                    var scope = $(".upload-direct");
                    var flag = false;
                    scope.find(".async-upload").each(function () {
                        if ($(this).data("upload-iscompleted") == true) {
                            flag = true;
                            return false;
                        }
                    });
                    return flag;
                }
                function isSubmitting() {
                    var scope = $(".upload-direct");
                    return scope.data("is-submitting") == true;
                }
                ;
                function initializeUpload(fileInput) {
                    var scope = fileInput.closest(".async-upload");
                    var fileUploadWrapper = scope.find(".file-upload-wrapper");
                    var acceptFileTypesRegex = new RegExp(scope.data("upload-accept-file-types"));
                    var antiForgeryToken = scope.closest("form").find("[name='__RequestVerificationToken']").val();
                    var selectedFileWrapper = scope.find(".selected-file-wrapper");
                    var filenameInput = scope.find(".filename-input");
                    var resetButton = scope.find(".reset-button");
                    var uploadButton = scope.find(".upload-button");
                    var filenameText = scope.find(".filename-text");
                    var validationText = scope.find(".validation-text");
                    var preparingText = scope.find(".status.preparing");
                    var uploadingContainer = scope.find(".status.uploading");
                    var progressBar = scope.find(".progress-bar");
                    var progressText = scope.find(".progress-text");
                    var progressDetails = scope.find(".progress-details");
                    var cancelLink = scope.find(".cancel-link");
                    fileInput.fileupload({
                        autoUpload: false,
                        acceptFileTypes: acceptFileTypesRegex,
                        type: "PUT",
                        maxChunkSize: 4 * 1024 * 1024,
                        beforeSend: function (xhr, data) {
                            xhr.setRequestHeader("x-ms-date", new Date().toUTCString());
                            xhr.setRequestHeader("x-ms-blob-type", "BlockBlob");
                            xhr.setRequestHeader("content-length", data.data.size.toString());
                        },
                        chunksend: function (e, data) {
                            var blockIndex = scope.data("block-index");
                            var blockIds = scope.data("block-ids");
                            var blockId = createBlockId(blockIndex);
                            var url = scope.data("sas-locator") + "&comp=block&blockid=" + blockId;
                            data.url = url;
                            blockIds.push(blockId);
                            scope.data("block-index", blockIndex + 1);
                        },
                        progressall: function (e, data) {
                            var percentComplete = Math.floor((data.loaded / data.total) * 100);
                            var startTime = new Date(scope.data("upload-start-time"));
                            var elapsedMilliseconds = new Date(Date.now()).getTime() - startTime.getTime();
                            var elapsed = moment.duration(elapsedMilliseconds, "ms");
                            var remaining = moment.duration(elapsedMilliseconds / Math.max(data.loaded, 1) * (data.total - data.loaded), "ms");
                            var kbps = Math.floor(data.bitrate / 8 / 1000);
                            var uploaded = Math.floor(data.loaded / 1000);
                            var total = Math.floor(data.total / 1000);
                            progressBar.show().find(".progress").css("width", percentComplete + "%");
                            progressText.text(progressText.data("text-template").replace("{percentage}", percentComplete)).show();
                            progressDetails.text(progressDetails.data("text-template").replace("{uploaded}", uploaded).replace("{total}", total).replace("{kbps}", kbps).replace("{elapsed}", elapsed.humanize()).replace("{remaining}", remaining.humanize())).show();
                        },
                        done: function (e, data) {
                            var self = this;
                            commitBlockList(scope, data).always(function () {
                                uploadCompleted(self, e, data);
                            });
                        },
                        fail: function (e, data) {
                            uploadCompleted(this, e, data);
                        },
                        processdone: function (e, data) {
                            var selectedFilename = data.files[0].name;
                            scope.data("selected-filename", selectedFilename);
                            window.setTimeout(function () {
                                fileUploadWrapper.hide();
                                validationText.hide();
                                selectedFileWrapper.show();
                                filenameText.text(filenameText.data("text-template").replace("{filename}", selectedFilename));
                            }, 10);
                            scope[0].doReset = function () {
                                fileUploadWrapper.show();
                                filenameInput.val("");
                                filenameText.text("");
                                selectedFileWrapper.hide();
                                validationText.hide();
                            };
                            scope[0].doUpload = function () {
                                var editedFilename = filenameInput.val() || selectedFilename;
                                if (!acceptFileTypesRegex.test(editedFilename)) {
                                    validationText.show();
                                    return;
                                }
                                scope.data("upload-isactive", true);
                                scope.data("upload-start-time", Date.now());
                                var generateAssetUrl = scope.data("generate-asset-url");
                                scope.data("block-index", 0);
                                scope.data("block-ids", new Array());
                                preparingText.show();
                                selectedFileWrapper.hide();
                                validationText.hide();
                                $.ajax({
                                    url: generateAssetUrl,
                                    data: {
                                        filename: editedFilename,
                                        __RequestVerificationToken: antiForgeryToken
                                    },
                                    type: "POST"
                                }).done(function (asset) {
                                    data.url = asset.sasLocator;
                                    data.multipart = false;
                                    scope.data("sas-locator", asset.sasLocator);
                                    scope.find("input[name$='.FileName']").val(editedFilename);
                                    scope.find("input[name$='.WamsAssetId']").val(asset.assetId);
                                    preparingText.hide();
                                    progressText.text(progressText.data("text-template").replace("{percentage}", 0)).show();
                                    uploadingContainer.show();
                                    var xhr = data.submit();
                                    scope.data("xhr", xhr);
                                }).fail(function (xhr, status, error) {
                                    fileUploadWrapper.show();
                                    selectedFileWrapper.show();
                                    preparingText.hide();
                                    uploadingContainer.hide();
                                    scope.data("upload-isactive", false);
                                    scope.data("upload-start-time", null);
                                    alert("An error occurred. Error: " + error);
                                });
                            };
                        },
                        processfail: function (e, data) {
                            validationText.show();
                            filenameInput.val("");
                            filenameText.text("");
                            selectedFileWrapper.hide();
                        },
                        change: function (e, data) {
                            var prompt = fileInput.data("prompt");
                            if (prompt && prompt.length > 0) {
                                if (!confirm(prompt)) {
                                    e.preventDefault();
                                }
                            }
                        }
                    });
                    cancelLink.on("click", function (e) {
                        e.preventDefault();
                        if (confirm($(this).data("cancel-prompt"))) {
                            var xhr = scope.data("xhr");
                            xhr.abort();
                        }
                    });
                }
                function initializeUploadDirect() {
                    var scope = $(".upload-direct").show();
                    scope.find(".reset-button").on("click", function (e) {
                        var doReset = $(this).closest(".async-upload")[0].doReset;
                        if (!!doReset)
                            doReset();
                    });
                    scope.find(".upload-button").on("click", function (e) {
                        var doUpload = $(this).closest(".async-upload")[0].doUpload;
                        if (!!doUpload)
                            doUpload();
                    });
                    requiredUploads = scope.find(".required-upload");
                    scope.find(".async-upload-file-input").each(function () {
                        initializeUpload($(this));
                    });
                    scope.closest("form").on("submit", function (e) {
                        if (hasActiveUploads()) {
                            alert(scope.data("block-submit-prompt"));
                            e.preventDefault();
                            return false;
                        }
                        scope.data("is-submitting", true);
                    });
                    $(window).on("beforeunload", function (e) {
                        if ((hasActiveUploads() || hasCompletedUploads()) && !isSubmitting()) {
                            var message = scope.data("navigate-away-prompt");
                            e.result = message;
                            return message;
                        }
                    });
                }
                CloudVideoEdit.initializeUploadDirect = initializeUploadDirect;
            })(CloudVideoEdit = MediaServices.CloudVideoEdit || (MediaServices.CloudVideoEdit = {}));
        })(MediaServices = Azure.MediaServices || (Azure.MediaServices = {}));
    })(Azure = Orchard.Azure || (Orchard.Azure = {}));
})(Orchard || (Orchard = {}));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsb3VkbWVkaWEtZWRpdC1jbG91ZHZpZGVvcGFydC1kaXJlY3QudHMiXSwibmFtZXMiOlsiT3JjaGFyZCIsIk9yY2hhcmQuQXp1cmUiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQudXBsb2FkQ29tcGxldGVkIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LmNsZWFudXAiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQucGFkIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LmNyZWF0ZUJsb2NrSWQiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQuY29tbWl0QmxvY2tMaXN0IiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0Lmhhc0FjdGl2ZVVwbG9hZHMiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQuaGFzQ29tcGxldGVkVXBsb2FkcyIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5DbG91ZFZpZGVvRWRpdC5pc1N1Ym1pdHRpbmciLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuQ2xvdWRWaWRlb0VkaXQuaW5pdGlhbGl6ZVVwbG9hZCIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5DbG91ZFZpZGVvRWRpdC5pbml0aWFsaXplVXBsb2FkRGlyZWN0Il0sIm1hcHBpbmdzIjoiOzs7OztBQUFBLDRDQUE0QztBQUM1Qyw4Q0FBOEM7QUFDOUMsNENBQTRDO0FBRTVDLElBQU8sT0FBTyxDQWlXYjtBQWpXRCxXQUFPLE9BQU87SUFBQ0EsSUFBQUEsS0FBS0EsQ0FpV25CQTtJQWpX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QUMsT0FBTyxDQUFDO3dCQUNuQixDQUFDO29CQUNMLENBQUMsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLENBQUNBO2dCQXZDZVYscUNBQXNCQSx5QkF1Q3JDQSxDQUFBQTtZQUNMQSxDQUFDQSxFQWpXa0NELGNBQWNBLEdBQWRBLDRCQUFjQSxLQUFkQSw0QkFBY0EsUUFpV2hEQTtRQUFEQSxDQUFDQSxFQWpXb0JELGFBQWFBLEdBQWJBLG1CQUFhQSxLQUFiQSxtQkFBYUEsUUFpV2pDQTtJQUFEQSxDQUFDQSxFQWpXY0QsS0FBS0EsR0FBTEEsYUFBS0EsS0FBTEEsYUFBS0EsUUFpV25CQTtBQUFEQSxDQUFDQSxFQWpXTSxPQUFPLEtBQVAsT0FBTyxRQWlXYiIsImZpbGUiOiJjbG91ZG1lZGlhLWVkaXQtY2xvdWR2aWRlb3BhcnQtZGlyZWN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlR5cGluZ3MvanF1ZXJ5LmQudHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiVHlwaW5ncy9qcXVlcnl1aS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlR5cGluZ3MvbW9tZW50LmQudHNcIiAvPlxyXG5cclxubW9kdWxlIE9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5DbG91ZFZpZGVvRWRpdCB7XHJcbiAgICB2YXIgcmVxdWlyZWRVcGxvYWRzOiBKUXVlcnk7XHJcblxyXG4gICAgZnVuY3Rpb24gdXBsb2FkQ29tcGxldGVkKHNlbmRlcjogYW55LCBlOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgIHZhciBzY29wZSA9ICQoc2VuZGVyKS5jbG9zZXN0KFwiLmFzeW5jLXVwbG9hZFwiKTtcclxuICAgICAgICB2YXIgc3RhdHVzID0gZGF0YS5lcnJvclRocm93biAmJiBkYXRhLmVycm9yVGhyb3duLmxlbmd0aCA+IDAgPyBkYXRhLmVycm9yVGhyb3duIDogZGF0YS50ZXh0U3RhdHVzO1xyXG4gICAgICAgIHNjb3BlLmZpbmQoXCIucHJvZ3Jlc3MtYmFyXCIpLmhpZGUoKTtcclxuICAgICAgICBzY29wZS5maW5kKFwiLnByb2dyZXNzLXRleHRcIikuaGlkZSgpO1xyXG4gICAgICAgIHNjb3BlLmZpbmQoXCIucHJvZ3Jlc3MtZGV0YWlsc1wiKS5oaWRlKCk7XHJcbiAgICAgICAgc2NvcGUuZmluZChcIi5zdGF0dXMucHJlcGFyaW5nXCIpLmhpZGUoKTtcclxuICAgICAgICBzY29wZS5maW5kKFwiLnN0YXR1cy51cGxvYWRpbmdcIikuaGlkZSgpO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xyXG4gICAgICAgICAgICBjYXNlIFwiZXJyb3JcIjpcclxuICAgICAgICAgICAgICAgIGNsZWFudXAoc2NvcGUsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoXCJUaGUgdXBsb2FkIG9mIHRoZSBzZWxlY3RlZCBmaWxlIGZhaWxlZC4gWW91IG1heSB0cnkgYWdhaW4gYWZ0ZXIgdGhlIGNsZWFudXAgaGFzIGZpbmlzaGVkLlwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgY2FzZSBcImFib3J0XCI6XHJcbiAgICAgICAgICAgICAgICBjbGVhbnVwKHNjb3BlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBlZGl0ZWRGaWxlTmFtZSA9IHNjb3BlLmZpbmQoXCJpbnB1dFtuYW1lJD0nLkZpbGVOYW1lJ11cIikudmFsKCk7XHJcbiAgICAgICAgdmFyIHN0YXR1c1VwbG9hZGVkID0gc2NvcGUuZmluZChcIi5zdGF0dXMudXBsb2FkZWRcIikuc2hvdygpO1xyXG5cclxuICAgICAgICBzdGF0dXNVcGxvYWRlZC50ZXh0KHN0YXR1c1VwbG9hZGVkLmRhdGEoXCJ0ZXh0LXRlbXBsYXRlXCIpLnJlcGxhY2UoXCJ7ZmlsZW5hbWV9XCIsIGVkaXRlZEZpbGVOYW1lKSk7XHJcbiAgICAgICAgc2NvcGUuZGF0YShcInVwbG9hZC1pc2FjdGl2ZVwiLCBmYWxzZSk7XHJcbiAgICAgICAgc2NvcGUuZGF0YShcInVwbG9hZC1pc2NvbXBsZXRlZFwiLCB0cnVlKTtcclxuICAgICAgICBzY29wZS5kYXRhKFwidXBsb2FkLXN0YXJ0LXRpbWVcIiwgbnVsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY2xlYW51cChzY29wZTogSlF1ZXJ5LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICB2YXIgd2Ftc0Fzc2V0SW5wdXQgPSBzY29wZS5maW5kKFwiaW5wdXRbbmFtZSQ9Jy5XYW1zQXNzZXRJZCddXCIpO1xyXG4gICAgICAgIHZhciBmaWxlTmFtZUlucHV0ID0gc2NvcGUuZmluZChcImlucHV0W25hbWUkPScuRmlsZU5hbWUnXVwiKTtcclxuICAgICAgICB2YXIgYXNzZXRJZCA9ICQudHJpbSh3YW1zQXNzZXRJbnB1dC52YWwoKSk7XHJcbiAgICAgICAgdmFyIGZpbGVVcGxvYWRXcmFwcGVyID0gZGF0YS5maWxlSW5wdXQuY2xvc2VzdChcIi5maWxlLXVwbG9hZC13cmFwcGVyXCIpO1xyXG5cclxuICAgICAgICBpZiAoYXNzZXRJZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBzY29wZS5kYXRhKFwiZGVsZXRlLWFzc2V0LXVybFwiKTtcclxuICAgICAgICAgICAgdmFyIGFudGlGb3JnZXJ5VG9rZW4gPSBzY29wZS5jbG9zZXN0KFwiZm9ybVwiKS5maW5kKFwiW25hbWU9J19fUmVxdWVzdFZlcmlmaWNhdGlvblRva2VuJ11cIikudmFsKCk7XHJcbiAgICAgICAgICAgIHZhciBjbGVhbnVwTWVzc2FnZSA9IHNjb3BlLmZpbmQoXCIuc3RhdHVzLmNsZWFudXBcIik7XHJcblxyXG4gICAgICAgICAgICB3YW1zQXNzZXRJbnB1dC52YWwoXCJcIik7XHJcbiAgICAgICAgICAgIGZpbGVOYW1lSW5wdXQudmFsKFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgY2xlYW51cE1lc3NhZ2Uuc2hvdygpO1xyXG5cclxuICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJERUxFVEVcIixcclxuICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogYXNzZXRJZCxcclxuICAgICAgICAgICAgICAgICAgICBfX1JlcXVlc3RWZXJpZmljYXRpb25Ub2tlbjogYW50aUZvcmdlcnlUb2tlblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmRhdGEoXCJ1cGxvYWQtaXNhY3RpdmVcIiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcInVwbG9hZC1zdGFydC10aW1lXCIsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZmluZChcIi5maWxlLXVwbG9hZC13cmFwcGVyXCIpLnNob3coKTtcclxuICAgICAgICAgICAgICAgIGNsZWFudXBNZXNzYWdlLmhpZGUoKTtcclxuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBhbGVydChcIkFuIGVycm9yIG9jY3VycmVkIG9uIHRoZSBzZXJ2ZXIgd2hpbGUgdHJ5aW5nIHRvIGNsZWFuIHVwLlwiKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmaWxlVXBsb2FkV3JhcHBlci5zaG93KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcGFkKHZhbHVlOiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XHJcbiAgICAgICAgdmFyIHN0ciA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgd2hpbGUgKHN0ci5sZW5ndGggPCBsZW5ndGgpIHtcclxuICAgICAgICAgICAgc3RyID0gXCIwXCIgKyBzdHI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHI7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY3JlYXRlQmxvY2tJZChibG9ja0luZGV4OiBudW1iZXIpIHtcclxuICAgICAgICB2YXIgYmxvY2tJZFByZWZpeCA9IFwiYmxvY2stXCI7XHJcbiAgICAgICAgcmV0dXJuIGJ0b2EoYmxvY2tJZFByZWZpeCArIHBhZChibG9ja0luZGV4LCA2KSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY29tbWl0QmxvY2tMaXN0KHNjb3BlOiBKUXVlcnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcclxuICAgICAgICB2YXIgYmxvY2tJZHMgPSBzY29wZS5kYXRhKFwiYmxvY2staWRzXCIpO1xyXG5cclxuICAgICAgICBpZiAoYmxvY2tJZHMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgLy8gVGhlIGZpbGUgd2FzIHVwbG9hZGVkIGFzIGEgd2hvbGUsIHNvIG5vIG1hbmlmZXN0IHRvIHN1Ym1pdC5cclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFRoZSBmaWxlIHdhcyB1cGxvYWRlZCBpbiBjaHVua3MuXHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBzY29wZS5kYXRhKFwic2FzLWxvY2F0b3JcIikgKyBcIiZjb21wPWJsb2NrbGlzdFwiO1xyXG4gICAgICAgICAgICB2YXIgcmVxdWVzdERhdGEgPSAnPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+PEJsb2NrTGlzdD4nO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJsb2NrSWRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YSArPSAnPExhdGVzdD4nICsgYmxvY2tJZHNbaV0gKyAnPC9MYXRlc3Q+JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXF1ZXN0RGF0YSArPSAnPC9CbG9ja0xpc3Q+JztcclxuXHJcbiAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiUFVUXCIsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiByZXF1ZXN0RGF0YSxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcInRleHQvcGxhaW47IGNoYXJzZXQ9VVRGLThcIixcclxuICAgICAgICAgICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gKHhocikge1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCd4LW1zLWRhdGUnLCBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCd4LW1zLWJsb2ItY29udGVudC10eXBlJywgZGF0YS5maWxlc1swXS50eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcigneC1tcy12ZXJzaW9uJywgXCIyMDEyLTAyLTEyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LUxlbmd0aCcsIHJlcXVlc3REYXRhLmxlbmd0aC50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgc3RhdHVzLCBlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGV4dFN0YXR1cyA9IHN0YXR1cztcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9yVGhyb3duID0gZXJyb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQuZmFpbChkYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGhhc0FjdGl2ZVVwbG9hZHMoKSB7XHJcbiAgICAgICAgdmFyIHNjb3BlID0gJChcIi51cGxvYWQtZGlyZWN0XCIpO1xyXG4gICAgICAgIHZhciBmbGFnID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHNjb3BlLmZpbmQoXCIuYXN5bmMtdXBsb2FkXCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKFwidXBsb2FkLWlzYWN0aXZlXCIpID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBmbGFnO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGhhc0NvbXBsZXRlZFVwbG9hZHMoKSB7XHJcbiAgICAgICAgdmFyIHNjb3BlID0gJChcIi51cGxvYWQtZGlyZWN0XCIpO1xyXG4gICAgICAgIHZhciBmbGFnID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHNjb3BlLmZpbmQoXCIuYXN5bmMtdXBsb2FkXCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKFwidXBsb2FkLWlzY29tcGxldGVkXCIpID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBmbGFnO1xyXG4gICAgfSBcclxuXHJcbiAgICBmdW5jdGlvbiBpc1N1Ym1pdHRpbmcoKSB7XHJcbiAgICAgICAgdmFyIHNjb3BlID0gJChcIi51cGxvYWQtZGlyZWN0XCIpO1xyXG4gICAgICAgIHJldHVybiBzY29wZS5kYXRhKFwiaXMtc3VibWl0dGluZ1wiKSA9PSB0cnVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBpbml0aWFsaXplVXBsb2FkKGZpbGVJbnB1dDogSlF1ZXJ5KSB7XHJcbiAgICAgICAgdmFyIHNjb3BlID0gZmlsZUlucHV0LmNsb3Nlc3QoXCIuYXN5bmMtdXBsb2FkXCIpO1xyXG4gICAgICAgIHZhciBmaWxlVXBsb2FkV3JhcHBlciA9IHNjb3BlLmZpbmQoXCIuZmlsZS11cGxvYWQtd3JhcHBlclwiKTtcclxuICAgICAgICB2YXIgYWNjZXB0RmlsZVR5cGVzUmVnZXggPSBuZXcgUmVnRXhwKHNjb3BlLmRhdGEoXCJ1cGxvYWQtYWNjZXB0LWZpbGUtdHlwZXNcIikpO1xyXG4gICAgICAgIHZhciBhbnRpRm9yZ2VyeVRva2VuOiBzdHJpbmcgPSBzY29wZS5jbG9zZXN0KFwiZm9ybVwiKS5maW5kKFwiW25hbWU9J19fUmVxdWVzdFZlcmlmaWNhdGlvblRva2VuJ11cIikudmFsKCk7XHJcblxyXG4gICAgICAgIHZhciBzZWxlY3RlZEZpbGVXcmFwcGVyID0gc2NvcGUuZmluZChcIi5zZWxlY3RlZC1maWxlLXdyYXBwZXJcIik7XHJcbiAgICAgICAgdmFyIGZpbGVuYW1lSW5wdXQgPSBzY29wZS5maW5kKFwiLmZpbGVuYW1lLWlucHV0XCIpO1xyXG4gICAgICAgIHZhciByZXNldEJ1dHRvbiA9IHNjb3BlLmZpbmQoXCIucmVzZXQtYnV0dG9uXCIpO1xyXG4gICAgICAgIHZhciB1cGxvYWRCdXR0b24gPSBzY29wZS5maW5kKFwiLnVwbG9hZC1idXR0b25cIik7XHJcbiAgICAgICAgdmFyIGZpbGVuYW1lVGV4dCA9IHNjb3BlLmZpbmQoXCIuZmlsZW5hbWUtdGV4dFwiKTtcclxuXHJcbiAgICAgICAgdmFyIHZhbGlkYXRpb25UZXh0ID0gc2NvcGUuZmluZChcIi52YWxpZGF0aW9uLXRleHRcIik7XHJcbiAgICAgICAgdmFyIHByZXBhcmluZ1RleHQgPSBzY29wZS5maW5kKFwiLnN0YXR1cy5wcmVwYXJpbmdcIik7XHJcbiAgICAgICAgdmFyIHVwbG9hZGluZ0NvbnRhaW5lciA9IHNjb3BlLmZpbmQoXCIuc3RhdHVzLnVwbG9hZGluZ1wiKTtcclxuICAgICAgICB2YXIgcHJvZ3Jlc3NCYXIgPSBzY29wZS5maW5kKFwiLnByb2dyZXNzLWJhclwiKTtcclxuICAgICAgICB2YXIgcHJvZ3Jlc3NUZXh0ID0gc2NvcGUuZmluZChcIi5wcm9ncmVzcy10ZXh0XCIpO1xyXG4gICAgICAgIHZhciBwcm9ncmVzc0RldGFpbHMgPSBzY29wZS5maW5kKFwiLnByb2dyZXNzLWRldGFpbHNcIik7XHJcbiAgICAgICAgdmFyIGNhbmNlbExpbmsgPSBzY29wZS5maW5kKFwiLmNhbmNlbC1saW5rXCIpOyBcclxuXHJcbiAgICAgICAgKDxhbnk+ZmlsZUlucHV0KS5maWxldXBsb2FkKHtcclxuICAgICAgICAgICAgYXV0b1VwbG9hZDogZmFsc2UsXHJcbiAgICAgICAgICAgIGFjY2VwdEZpbGVUeXBlczogYWNjZXB0RmlsZVR5cGVzUmVnZXgsXHJcbiAgICAgICAgICAgIHR5cGU6IFwiUFVUXCIsXHJcbiAgICAgICAgICAgIG1heENodW5rU2l6ZTogNCAqIDEwMjQgKiAxMDI0LCAvLyA0IE1CXHJcbiAgICAgICAgICAgIGJlZm9yZVNlbmQ6ICh4aHI6IEpRdWVyeVhIUiwgZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIngtbXMtZGF0ZVwiLCBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJ4LW1zLWJsb2ItdHlwZVwiLCBcIkJsb2NrQmxvYlwiKTtcclxuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiY29udGVudC1sZW5ndGhcIiwgZGF0YS5kYXRhLnNpemUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNodW5rc2VuZDogZnVuY3Rpb24gKGU6IGFueSwgZGF0YTogYW55KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmxvY2tJbmRleCA9IHNjb3BlLmRhdGEoXCJibG9jay1pbmRleFwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBibG9ja0lkcyA9IHNjb3BlLmRhdGEoXCJibG9jay1pZHNcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmxvY2tJZCA9IGNyZWF0ZUJsb2NrSWQoYmxvY2tJbmRleCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gc2NvcGUuZGF0YShcInNhcy1sb2NhdG9yXCIpICsgXCImY29tcD1ibG9jayZibG9ja2lkPVwiICsgYmxvY2tJZDtcclxuXHJcbiAgICAgICAgICAgICAgICBkYXRhLnVybCA9IHVybDtcclxuICAgICAgICAgICAgICAgIGJsb2NrSWRzLnB1c2goYmxvY2tJZCk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwiYmxvY2staW5kZXhcIiwgYmxvY2tJbmRleCArIDEpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBwcm9ncmVzc2FsbDogZnVuY3Rpb24gKGU6IGFueSwgZGF0YTogYW55KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGVyY2VudENvbXBsZXRlID0gTWF0aC5mbG9vcigoZGF0YS5sb2FkZWQgLyBkYXRhLnRvdGFsKSAqIDEwMCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnRUaW1lID0gbmV3IERhdGUoc2NvcGUuZGF0YShcInVwbG9hZC1zdGFydC10aW1lXCIpKTtcclxuICAgICAgICAgICAgICAgIHZhciBlbGFwc2VkTWlsbGlzZWNvbmRzID0gbmV3IERhdGUoRGF0ZS5ub3coKSkuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgIHZhciBlbGFwc2VkID0gbW9tZW50LmR1cmF0aW9uKGVsYXBzZWRNaWxsaXNlY29uZHMsIFwibXNcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVtYWluaW5nID0gbW9tZW50LmR1cmF0aW9uKGVsYXBzZWRNaWxsaXNlY29uZHMgLyBNYXRoLm1heChkYXRhLmxvYWRlZCwgMSkgKiAoZGF0YS50b3RhbCAtIGRhdGEubG9hZGVkKSwgXCJtc1wiKTtcclxuICAgICAgICAgICAgICAgIHZhciBrYnBzID0gTWF0aC5mbG9vcihkYXRhLmJpdHJhdGUgLyA4IC8gMTAwMCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXBsb2FkZWQgPSBNYXRoLmZsb29yKGRhdGEubG9hZGVkIC8gMTAwMCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG90YWwgPSBNYXRoLmZsb29yKGRhdGEudG90YWwgLyAxMDAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzc0Jhci5zaG93KCkuZmluZChcIi5wcm9ncmVzc1wiKS5jc3MoXCJ3aWR0aFwiLCBwZXJjZW50Q29tcGxldGUgKyBcIiVcIik7XHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzc1RleHQudGV4dChwcm9ncmVzc1RleHQuZGF0YShcInRleHQtdGVtcGxhdGVcIikucmVwbGFjZShcIntwZXJjZW50YWdlfVwiLCBwZXJjZW50Q29tcGxldGUpKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzc0RldGFpbHMudGV4dChwcm9ncmVzc0RldGFpbHMuZGF0YShcInRleHQtdGVtcGxhdGVcIikucmVwbGFjZShcInt1cGxvYWRlZH1cIiwgdXBsb2FkZWQpLnJlcGxhY2UoXCJ7dG90YWx9XCIsIHRvdGFsKS5yZXBsYWNlKFwie2ticHN9XCIsIGticHMpLnJlcGxhY2UoXCJ7ZWxhcHNlZH1cIiwgZWxhcHNlZC5odW1hbml6ZSgpKS5yZXBsYWNlKFwie3JlbWFpbmluZ31cIiwgcmVtYWluaW5nLmh1bWFuaXplKCkpKS5zaG93KCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGRvbmU6IGZ1bmN0aW9uIChlOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgY29tbWl0QmxvY2tMaXN0KHNjb3BlLCBkYXRhKS5hbHdheXMoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZENvbXBsZXRlZChzZWxmLCBlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmYWlsOiBmdW5jdGlvbiAoZTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIHVwbG9hZENvbXBsZXRlZCh0aGlzLCBlLCBkYXRhKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcHJvY2Vzc2RvbmU6IGZ1bmN0aW9uIChlOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkRmlsZW5hbWUgPSBkYXRhLmZpbGVzWzBdLm5hbWU7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwic2VsZWN0ZWQtZmlsZW5hbWVcIiwgc2VsZWN0ZWRGaWxlbmFtZSk7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZVVwbG9hZFdyYXBwZXIuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25UZXh0LmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpbGVXcmFwcGVyLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZVRleHQudGV4dChmaWxlbmFtZVRleHQuZGF0YShcInRleHQtdGVtcGxhdGVcIikucmVwbGFjZShcIntmaWxlbmFtZX1cIiwgc2VsZWN0ZWRGaWxlbmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTApOyBcclxuXHJcbiAgICAgICAgICAgICAgICAoPGFueT5zY29wZVswXSkuZG9SZXNldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlVXBsb2FkV3JhcHBlci5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWVJbnB1dC52YWwoXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWVUZXh0LnRleHQoXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWxlV3JhcHBlci5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvblRleHQuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAoPGFueT5zY29wZVswXSkuZG9VcGxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRlZEZpbGVuYW1lID0gZmlsZW5hbWVJbnB1dC52YWwoKSB8fCBzZWxlY3RlZEZpbGVuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghYWNjZXB0RmlsZVR5cGVzUmVnZXgudGVzdChlZGl0ZWRGaWxlbmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvblRleHQuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwidXBsb2FkLWlzYWN0aXZlXCIsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmRhdGEoXCJ1cGxvYWQtc3RhcnQtdGltZVwiLCBEYXRlLm5vdygpKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ2VuZXJhdGVBc3NldFVybCA9IHNjb3BlLmRhdGEoXCJnZW5lcmF0ZS1hc3NldC11cmxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcImJsb2NrLWluZGV4XCIsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmRhdGEoXCJibG9jay1pZHNcIiwgbmV3IEFycmF5KCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBwcmVwYXJpbmdUZXh0LnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZpbGVXcmFwcGVyLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uVGV4dC5oaWRlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZ2VuZXJhdGVBc3NldFVybCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IGVkaXRlZEZpbGVuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19SZXF1ZXN0VmVyaWZpY2F0aW9uVG9rZW46IGFudGlGb3JnZXJ5VG9rZW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCJcclxuICAgICAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChhc3NldDogYW55KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnVybCA9IGFzc2V0LnNhc0xvY2F0b3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm11bHRpcGFydCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRhdGEoXCJzYXMtbG9jYXRvclwiLCBhc3NldC5zYXNMb2NhdG9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmZpbmQoXCJpbnB1dFtuYW1lJD0nLkZpbGVOYW1lJ11cIikudmFsKGVkaXRlZEZpbGVuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmZpbmQoXCJpbnB1dFtuYW1lJD0nLldhbXNBc3NldElkJ11cIikudmFsKGFzc2V0LmFzc2V0SWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXBhcmluZ1RleHQuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NUZXh0LnRleHQocHJvZ3Jlc3NUZXh0LmRhdGEoXCJ0ZXh0LXRlbXBsYXRlXCIpLnJlcGxhY2UoXCJ7cGVyY2VudGFnZX1cIiwgMCkpLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZGluZ0NvbnRhaW5lci5zaG93KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHhociA9IGRhdGEuc3VibWl0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwieGhyXCIsIHhocik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKHhocjogYW55LCBzdGF0dXM6IGFueSwgZXJyb3I6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVVwbG9hZFdyYXBwZXIuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWxlV3JhcHBlci5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVwYXJpbmdUZXh0LmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZGluZ0NvbnRhaW5lci5oaWRlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcInVwbG9hZC1pc2FjdGl2ZVwiLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRhKFwidXBsb2FkLXN0YXJ0LXRpbWVcIiwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIkFuIGVycm9yIG9jY3VycmVkLiBFcnJvcjogXCIgKyBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcHJvY2Vzc2ZhaWw6IGZ1bmN0aW9uIChlOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvblRleHQuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgZmlsZW5hbWVJbnB1dC52YWwoXCJcIik7XHJcbiAgICAgICAgICAgICAgICBmaWxlbmFtZVRleHQudGV4dChcIlwiKTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkRmlsZVdyYXBwZXIuaGlkZSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIChlOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb21wdCA9IGZpbGVJbnB1dC5kYXRhKFwicHJvbXB0XCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHByb21wdCAmJiBwcm9tcHQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghY29uZmlybShwcm9tcHQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY2FuY2VsTGluay5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChjb25maXJtKCQodGhpcykuZGF0YShcImNhbmNlbC1wcm9tcHRcIikpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeGhyID0gc2NvcGUuZGF0YShcInhoclwiKTtcclxuICAgICAgICAgICAgICAgIHhoci5hYm9ydCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVVcGxvYWREaXJlY3QoKSB7XHJcblxyXG4gICAgICAgIHZhciBzY29wZSA9ICQoXCIudXBsb2FkLWRpcmVjdFwiKS5zaG93KCk7XHJcblxyXG4gICAgICAgIHNjb3BlLmZpbmQoXCIucmVzZXQtYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIGRvUmVzZXQgPSAoPGFueT4kKHRoaXMpLmNsb3Nlc3QoXCIuYXN5bmMtdXBsb2FkXCIpWzBdKS5kb1Jlc2V0O1xyXG4gICAgICAgICAgICBpZiAoISFkb1Jlc2V0KVxyXG4gICAgICAgICAgICAgICAgZG9SZXNldCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzY29wZS5maW5kKFwiLnVwbG9hZC1idXR0b25cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgZG9VcGxvYWQgPSAoPGFueT4kKHRoaXMpLmNsb3Nlc3QoXCIuYXN5bmMtdXBsb2FkXCIpWzBdKS5kb1VwbG9hZDtcclxuICAgICAgICAgICAgaWYgKCEhZG9VcGxvYWQpXHJcbiAgICAgICAgICAgICAgICBkb1VwbG9hZCgpO1xyXG4gICAgICAgIH0pOyBcclxuICAgICAgICAgIFxyXG4gICAgICAgIHJlcXVpcmVkVXBsb2FkcyA9IHNjb3BlLmZpbmQoXCIucmVxdWlyZWQtdXBsb2FkXCIpO1xyXG5cclxuICAgICAgICBzY29wZS5maW5kKFwiLmFzeW5jLXVwbG9hZC1maWxlLWlucHV0XCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpbml0aWFsaXplVXBsb2FkKCQodGhpcykpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzY29wZS5jbG9zZXN0KFwiZm9ybVwiKS5vbihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAoaGFzQWN0aXZlVXBsb2FkcygpKSB7XHJcbiAgICAgICAgICAgICAgICBhbGVydChzY29wZS5kYXRhKFwiYmxvY2stc3VibWl0LXByb21wdFwiKSk7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmRhdGEoXCJpcy1zdWJtaXR0aW5nXCIsIHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICBcclxuICAgICAgICAkKHdpbmRvdykub24oXCJiZWZvcmV1bmxvYWRcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKChoYXNBY3RpdmVVcGxvYWRzKCkgfHwgaGFzQ29tcGxldGVkVXBsb2FkcygpKSAmJiAhaXNTdWJtaXR0aW5nKCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gc2NvcGUuZGF0YShcIm5hdmlnYXRlLWF3YXktcHJvbXB0XCIpO1xyXG4gICAgICAgICAgICAgICAgZS5yZXN1bHQgPSBtZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSJdfQ==
