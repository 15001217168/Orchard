/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/// <reference path="Typings/jquery.d.ts" />
/// <reference path="Typings/underscore.d.ts" />
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var Orchard;
(function (Orchard) {
    var Azure;
    (function (Azure) {
        var MediaServices;
        (function (MediaServices) {
            var VideoPlayer;
            (function (VideoPlayer) {
                var Injectors;
                (function (Injectors) {
                    Injectors.instances = new Array();
                    var SmpInjector = (function (_super) {
                        __extends(SmpInjector, _super);
                        function SmpInjector(container, playerWidth, playerHeight, autoPlay, assetData, applyMediaQueries, debugToConsole, nextInjector, contentBaseUrl) {
                            _super.call(this, container, playerWidth, playerHeight, autoPlay, assetData, applyMediaQueries, debugToConsole, nextInjector);
                            this.contentBaseUrl = contentBaseUrl;
                            this.flashVersion = "10.2.0";
                            this.innerElementId = container.id + "-inner";
                        }
                        SmpInjector.prototype.isSupported = function () {
                            var browserHasFlash = swfobject.hasFlashPlayerVersion(this.flashVersion);
                            var hasDynamicAssets = _(this.filteredAssets().DynamicVideoAssets).any();
                            var result = browserHasFlash && hasDynamicAssets;
                            this.debug("Browser has required Flash version: {0}", browserHasFlash);
                            this.debug("Item has at least one dynamic video asset: {0}", hasDynamicAssets);
                            this.debug("isSupported() returns {0}.", result);
                            return result;
                        };
                        SmpInjector.prototype.inject = function () {
                            var _this = this;
                            var firstDynamicAsset = _(this.filteredAssets().DynamicVideoAssets).first();
                            var firstThumbnailAsset = _(this.filteredAssets().ThumbnailAssets).first();
                            var flashvars = {
                                src: firstDynamicAsset.SmoothStreamingUrl,
                                plugin_AdaptiveStreamingPlugin: encodeURIComponent(this.contentBaseUrl + "MSAdaptiveStreamingPlugin.swf"),
                                AdaptiveStreamingPlugin_retryLive: "true",
                                AdaptiveStreamingPlugin_retryInterval: "10",
                                autoPlay: this.autoPlay.toString(),
                                bufferingOverlay: "false",
                                poster: firstThumbnailAsset ? encodeURIComponent(firstThumbnailAsset.MainFileUrl) : null,
                                javascriptCallbackFunction: "Orchard.Azure.MediaServices.VideoPlayer.Injectors.onSmpBridgeCreated"
                            };
                            var params = {
                                allowFullScreen: "true",
                                allowScriptAccess: "always",
                                wmode: "direct"
                            };
                            var attributes = {
                                id: this.innerElementId
                            };
                            $("<div>").attr("id", this.innerElementId).appendTo(this.container);
                            this.debug("Injecting player into element '{0}'.", this.container.id);
                            swfobject.embedSWF(this.contentBaseUrl + "StrobeMediaPlayback.swf", this.innerElementId, this.playerWidth.toString(), this.playerHeight.toString(), this.flashVersion, this.contentBaseUrl + "expressInstall.swf", flashvars, params, attributes, function (e) {
                                if (!e.success)
                                    _this.fault();
                            });
                            Injectors.instances[this.innerElementId] = this;
                        };
                        SmpInjector.prototype.onMediaPlayerStateChange = function (state) {
                            if (state == "playbackError") {
                                this.debug("Playback error detected; cleaning up container and faulting this injector.");
                                Injectors.instances[this.innerElementId] = null;
                                this.fault();
                            }
                        };
                        SmpInjector.prototype.debug = function (message) {
                            var args = [];
                            for (var _i = 1; _i < arguments.length; _i++) {
                                args[_i - 1] = arguments[_i];
                            }
                            _super.prototype.debug.call(this, "SmpInjector: " + message, args);
                        };
                        return SmpInjector;
                    })(Injectors.Injector);
                    Injectors.SmpInjector = SmpInjector;
                    function onSmpBridgeCreated(playerElementId) {
                        var player = document.getElementById(playerElementId);
                        if (player) {
                            player.addEventListener("mediaPlayerStateChange", "Orchard.Azure.MediaServices.VideoPlayer.Injectors.instances[\"" + playerElementId + "\"].onMediaPlayerStateChange");
                        }
                    }
                    Injectors.onSmpBridgeCreated = onSmpBridgeCreated;
                })(Injectors = VideoPlayer.Injectors || (VideoPlayer.Injectors = {}));
            })(VideoPlayer = MediaServices.VideoPlayer || (MediaServices.VideoPlayer = {}));
        })(MediaServices = Azure.MediaServices || (Azure.MediaServices = {}));
    })(Azure = Orchard.Azure || (Orchard.Azure = {}));
})(Orchard || (Orchard = {}));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsb3VkbWVkaWEtdmlkZW9wbGF5ZXItaW5qZWN0b3JzLXNtcC50cyJdLCJuYW1lcyI6WyJPcmNoYXJkIiwiT3JjaGFyZC5BenVyZSIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcyIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5WaWRlb1BsYXllciIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5WaWRlb1BsYXllci5JbmplY3RvcnMiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuVmlkZW9QbGF5ZXIuSW5qZWN0b3JzLlNtcEluamVjdG9yIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkluamVjdG9ycy5TbXBJbmplY3Rvci5jb25zdHJ1Y3RvciIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5WaWRlb1BsYXllci5JbmplY3RvcnMuU21wSW5qZWN0b3IuaXNTdXBwb3J0ZWQiLCJPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuVmlkZW9QbGF5ZXIuSW5qZWN0b3JzLlNtcEluamVjdG9yLmluamVjdCIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5WaWRlb1BsYXllci5JbmplY3RvcnMuU21wSW5qZWN0b3Iub25NZWRpYVBsYXllclN0YXRlQ2hhbmdlIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkluamVjdG9ycy5TbXBJbmplY3Rvci5kZWJ1ZyIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5WaWRlb1BsYXllci5JbmplY3RvcnMub25TbXBCcmlkZ2VDcmVhdGVkIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBLDRDQUE0QztBQUM1QyxnREFBZ0Q7Ozs7OztBQUVoRCxJQUFPLE9BQU8sQ0F3R2I7QUF4R0QsV0FBTyxPQUFPO0lBQUNBLElBQUFBLEtBQUtBLENBd0duQkE7SUF4R2NBLFdBQUFBLEtBQUtBO1FBQUNDLElBQUFBLGFBQWFBLENBd0dqQ0E7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LEtBQVhBLHlCQUFXQSxRQXdHN0NBO1FBQURBLENBQUNBLEVBeEdvQkQsYUFBYUEsR0FBYkEsbUJBQWFBLEtBQWJBLG1CQUFhQSxRQXdHakNBO0lBQURBLENBQUNBLEVBeEdjRCxLQUFLQSxHQUFMQSxhQUFLQSxLQUFMQSxhQUFLQSxRQXdHbkJBO0FBQURBLENBQUNBLEVBeEdNLE9BQU8sS0FBUCxPQUFPLFFBd0diIiwiZmlsZSI6ImNsb3VkbWVkaWEtdmlkZW9wbGF5ZXItaW5qZWN0b3JzLXNtcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJUeXBpbmdzL2pxdWVyeS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlR5cGluZ3MvdW5kZXJzY29yZS5kLnRzXCIgLz5cclxuXHJcbm1vZHVsZSBPcmNoYXJkLkF6dXJlLk1lZGlhU2VydmljZXMuVmlkZW9QbGF5ZXIuSW5qZWN0b3JzIHtcclxuXHJcbiAgICBpbXBvcnQgRGF0YSA9IE9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5WaWRlb1BsYXllci5EYXRhO1xyXG5cclxuICAgIGRlY2xhcmUgdmFyIHN3Zm9iamVjdDogYW55O1xyXG5cclxuICAgIGV4cG9ydCB2YXIgaW5zdGFuY2VzOiBTbXBJbmplY3RvcltdID0gbmV3IEFycmF5KCk7XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIFNtcEluamVjdG9yIGV4dGVuZHMgSW5qZWN0b3Ige1xyXG5cclxuICAgICAgICBwcml2YXRlIGZsYXNoVmVyc2lvbiA9IFwiMTAuMi4wXCI7XHJcbiAgICAgICAgcHJpdmF0ZSBpbm5lckVsZW1lbnRJZDogc3RyaW5nO1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAgICAgY29udGFpbmVyOiBIVE1MRWxlbWVudCxcclxuICAgICAgICAgICAgcGxheWVyV2lkdGg6IG51bWJlcixcclxuICAgICAgICAgICAgcGxheWVySGVpZ2h0OiBudW1iZXIsXHJcbiAgICAgICAgICAgIGF1dG9QbGF5OiBib29sZWFuLFxyXG4gICAgICAgICAgICBhc3NldERhdGE6IERhdGEuSUFzc2V0RGF0YSxcclxuICAgICAgICAgICAgYXBwbHlNZWRpYVF1ZXJpZXM6IGJvb2xlYW4sXHJcbiAgICAgICAgICAgIGRlYnVnVG9Db25zb2xlOiBib29sZWFuLFxyXG4gICAgICAgICAgICBuZXh0SW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgICAgICBwcml2YXRlIGNvbnRlbnRCYXNlVXJsOiBzdHJpbmcpIHtcclxuICAgICAgICAgICAgc3VwZXIoY29udGFpbmVyLCBwbGF5ZXJXaWR0aCwgcGxheWVySGVpZ2h0LCBhdXRvUGxheSwgYXNzZXREYXRhLCBhcHBseU1lZGlhUXVlcmllcywgZGVidWdUb0NvbnNvbGUsIG5leHRJbmplY3Rvcik7XHJcbiAgICAgICAgICAgIHRoaXMuaW5uZXJFbGVtZW50SWQgPSBjb250YWluZXIuaWQgKyBcIi1pbm5lclwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGlzU3VwcG9ydGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgICAgICB2YXIgYnJvd3Nlckhhc0ZsYXNoID0gc3dmb2JqZWN0Lmhhc0ZsYXNoUGxheWVyVmVyc2lvbih0aGlzLmZsYXNoVmVyc2lvbik7XHJcbiAgICAgICAgICAgIHZhciBoYXNEeW5hbWljQXNzZXRzID0gXyh0aGlzLmZpbHRlcmVkQXNzZXRzKCkuRHluYW1pY1ZpZGVvQXNzZXRzKS5hbnkoKTtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGJyb3dzZXJIYXNGbGFzaCAmJiBoYXNEeW5hbWljQXNzZXRzO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kZWJ1ZyhcIkJyb3dzZXIgaGFzIHJlcXVpcmVkIEZsYXNoIHZlcnNpb246IHswfVwiLCBicm93c2VySGFzRmxhc2gpO1xyXG4gICAgICAgICAgICB0aGlzLmRlYnVnKFwiSXRlbSBoYXMgYXQgbGVhc3Qgb25lIGR5bmFtaWMgdmlkZW8gYXNzZXQ6IHswfVwiLCBoYXNEeW5hbWljQXNzZXRzKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGVidWcoXCJpc1N1cHBvcnRlZCgpIHJldHVybnMgezB9LlwiLCByZXN1bHQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGluamVjdCgpOiB2b2lkIHtcclxuICAgICAgICAgICAgdmFyIGZpcnN0RHluYW1pY0Fzc2V0ID0gXyh0aGlzLmZpbHRlcmVkQXNzZXRzKCkuRHluYW1pY1ZpZGVvQXNzZXRzKS5maXJzdCgpO1xyXG4gICAgICAgICAgICB2YXIgZmlyc3RUaHVtYm5haWxBc3NldCA9IF8odGhpcy5maWx0ZXJlZEFzc2V0cygpLlRodW1ibmFpbEFzc2V0cykuZmlyc3QoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBmbGFzaHZhcnMgPSB7XHJcbiAgICAgICAgICAgICAgICBzcmM6IGZpcnN0RHluYW1pY0Fzc2V0LlNtb290aFN0cmVhbWluZ1VybCxcclxuICAgICAgICAgICAgICAgIHBsdWdpbl9BZGFwdGl2ZVN0cmVhbWluZ1BsdWdpbjogZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuY29udGVudEJhc2VVcmwgKyBcIk1TQWRhcHRpdmVTdHJlYW1pbmdQbHVnaW4uc3dmXCIpLFxyXG4gICAgICAgICAgICAgICAgQWRhcHRpdmVTdHJlYW1pbmdQbHVnaW5fcmV0cnlMaXZlOiBcInRydWVcIixcclxuICAgICAgICAgICAgICAgIEFkYXB0aXZlU3RyZWFtaW5nUGx1Z2luX3JldHJ5SW50ZXJ2YWw6IFwiMTBcIixcclxuICAgICAgICAgICAgICAgIGF1dG9QbGF5OiB0aGlzLmF1dG9QbGF5LnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICBidWZmZXJpbmdPdmVybGF5OiBcImZhbHNlXCIsXHJcbiAgICAgICAgICAgICAgICBwb3N0ZXI6IGZpcnN0VGh1bWJuYWlsQXNzZXQgPyBlbmNvZGVVUklDb21wb25lbnQoZmlyc3RUaHVtYm5haWxBc3NldC5NYWluRmlsZVVybCkgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgamF2YXNjcmlwdENhbGxiYWNrRnVuY3Rpb246IFwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkluamVjdG9ycy5vblNtcEJyaWRnZUNyZWF0ZWRcIlxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XHJcbiAgICAgICAgICAgICAgICBhbGxvd0Z1bGxTY3JlZW46IFwidHJ1ZVwiLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dTY3JpcHRBY2Nlc3M6IFwiYWx3YXlzXCIsXHJcbiAgICAgICAgICAgICAgICB3bW9kZTogXCJkaXJlY3RcIlxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSB7XHJcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5pbm5lckVsZW1lbnRJZFxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJChcIjxkaXY+XCIpLmF0dHIoXCJpZFwiLCB0aGlzLmlubmVyRWxlbWVudElkKS5hcHBlbmRUbyh0aGlzLmNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIHRoaXMuZGVidWcoXCJJbmplY3RpbmcgcGxheWVyIGludG8gZWxlbWVudCAnezB9Jy5cIiwgdGhpcy5jb250YWluZXIuaWQpO1xyXG5cclxuICAgICAgICAgICAgc3dmb2JqZWN0LmVtYmVkU1dGKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50QmFzZVVybCArIFwiU3Ryb2JlTWVkaWFQbGF5YmFjay5zd2ZcIixcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5uZXJFbGVtZW50SWQsXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcldpZHRoLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllckhlaWdodC50b1N0cmluZygpLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5mbGFzaFZlcnNpb24sXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnRCYXNlVXJsICsgXCJleHByZXNzSW5zdGFsbC5zd2ZcIixcclxuICAgICAgICAgICAgICAgIGZsYXNodmFycyxcclxuICAgICAgICAgICAgICAgIHBhcmFtcyxcclxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMsXHJcbiAgICAgICAgICAgICAgICAoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlLnN1Y2Nlc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgKDxhbnk+aW5zdGFuY2VzKVt0aGlzLmlubmVyRWxlbWVudElkXSA9IHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICBcclxuICAgICAgICBwdWJsaWMgb25NZWRpYVBsYXllclN0YXRlQ2hhbmdlKHN0YXRlOiBzdHJpbmcpIHtcclxuICAgICAgICAgICAgaWYgKHN0YXRlID09IFwicGxheWJhY2tFcnJvclwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnKFwiUGxheWJhY2sgZXJyb3IgZGV0ZWN0ZWQ7IGNsZWFuaW5nIHVwIGNvbnRhaW5lciBhbmQgZmF1bHRpbmcgdGhpcyBpbmplY3Rvci5cIik7XHJcbiAgICAgICAgICAgICAgICAoPGFueT5pbnN0YW5jZXMpW3RoaXMuaW5uZXJFbGVtZW50SWRdID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmF1bHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogYW55W10pOiB2b2lkIHtcclxuICAgICAgICAgICAgc3VwZXIuZGVidWcoXCJTbXBJbmplY3RvcjogXCIgKyBtZXNzYWdlLCBhcmdzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAgXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gb25TbXBCcmlkZ2VDcmVhdGVkKHBsYXllckVsZW1lbnRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgdmFyIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHBsYXllckVsZW1lbnRJZCk7XHJcbiAgICAgICAgaWYgKHBsYXllcikge1xyXG4gICAgICAgICAgICAoPGFueT5wbGF5ZXIpLmFkZEV2ZW50TGlzdGVuZXIoXCJtZWRpYVBsYXllclN0YXRlQ2hhbmdlXCIsIFwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLlZpZGVvUGxheWVyLkluamVjdG9ycy5pbnN0YW5jZXNbXFxcIlwiICsgcGxheWVyRWxlbWVudElkICsgXCJcXFwiXS5vbk1lZGlhUGxheWVyU3RhdGVDaGFuZ2VcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfSBcclxufSJdfQ==
