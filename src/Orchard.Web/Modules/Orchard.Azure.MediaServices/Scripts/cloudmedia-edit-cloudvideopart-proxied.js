/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/// <reference path="Typings/jquery.d.ts" />
/// <reference path="Typings/jqueryui.d.ts" />
var Orchard;
(function (Orchard) {
    var Azure;
    (function (Azure) {
        var MediaServices;
        (function (MediaServices) {
            var CloudVideoEdit;
            (function (CloudVideoEdit) {
                var requiredUploads;
                var blocked;
                var hasRequiredUploadsp;
                function getAllFilesCompleted() {
                    var allFilesCompleted = true;
                    requiredUploads.find("input[name$='.OriginalFileName'], input.sync-upload-input").each(function () {
                        if ($(this).val() == "") {
                            allFilesCompleted = false;
                            return false;
                        }
                    });
                    return allFilesCompleted;
                }
                ;
                function unblockIfComplete() {
                    if (getAllFilesCompleted())
                        blocked.unblock();
                }
                function uploadCompleted(sender, data) {
                    var scope = $(sender).closest("[data-upload-accept-file-types]");
                    var status = data.errorThrown && data.errorThrown.length > 0 ? data.errorThrown : data.textStatus;
                    scope.find(".progress-bar").hide();
                    scope.find(".progress-text").hide();
                    scope.find(".cancel-upload").hide();
                    scope.data("upload-isactive", false);
                    switch (status) {
                        case "error":
                            alert("The upload of the selected file failed. One possible cause is that the file size exceeds the configured maxRequestLength setting (see: http://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.maxrequestlength(v=vs.110).aspx). Also make sure the executionTimeOut is set to allow for enough time for the request to execute when debug=\"false\".");
                            return;
                        case "abort":
                            return;
                    }
                    var temporaryFileName = data.result.temporaryFileName;
                    var originalFileName = data.result.originalFileName;
                    var fileSize = data.result.fileSize;
                    scope.find("input[name$='.OriginalFileName']").val(originalFileName);
                    scope.find("input[name$='.TemporaryFileName']").val(temporaryFileName);
                    scope.find("input[name$='.FileSize']").val(fileSize);
                    unblockIfComplete();
                    $(sender).replaceWith("<span>Successfully uploaded video file '" + originalFileName + "'.</span>");
                }
                function initializeUpload(fileInput) {
                    var scope = $(fileInput).closest("[data-upload-accept-file-types]");
                    var acceptFileTypes = scope.data("upload-accept-file-types");
                    var antiForgeryToken = requiredUploads.closest("form").find("[name='__RequestVerificationToken']").val();
                    var cancelUpload = scope.find(".cancel-upload");
                    fileInput.fileupload({
                        autoUpload: false,
                        acceptFileTypes: new RegExp(acceptFileTypes, "i"),
                        type: "POST",
                        url: scope.data("upload-fallback-url"),
                        formData: {
                            __RequestVerificationToken: antiForgeryToken
                        },
                        progressall: function (e, data) {
                            var percentComplete = Math.floor((data.loaded / data.total) * 100);
                            scope.find(".progress-bar").show().find('.progress').css('width', percentComplete + '%');
                            scope.find(".progress-text").show().text("Uploading (" + percentComplete + "%)...");
                        },
                        done: function (e, data) {
                            uploadCompleted(this, data);
                        },
                        fail: function (e, data) {
                            uploadCompleted(this, data);
                        },
                        processdone: function (e, data) {
                            scope.find(".validation-text").hide();
                            scope.data("upload-isactive", true);
                            cancelUpload.show();
                            var xhr = data.submit();
                            scope.data("xhr", xhr);
                        },
                        processfail: function (e, data) {
                            scope.find(".validation-text").show();
                        }
                    });
                    cancelUpload.on("click", function (e) {
                        e.preventDefault();
                        if (confirm("Are you sure you want to cancel this upload?")) {
                            var xhr = scope.data("xhr");
                            xhr.abort();
                        }
                    });
                }
                function initializeUploadProxied() {
                    var scopeProxied = $(".upload-proxied").show();
                    requiredUploads = scopeProxied.find(".required-uploads-group");
                    blocked = scopeProxied.find(".edit-item-sidebar");
                    hasRequiredUploadsp = requiredUploads.length > 0;
                    if (hasRequiredUploadsp) {
                        blocked.block({
                            message: requiredUploads.data("block-description"),
                            overlayCSS: {
                                backgroundColor: "#fff",
                                cursor: "default"
                            },
                            css: {
                                cursor: "default",
                                border: null,
                                width: null,
                                left: 0,
                                margin: "30px 0 0 0",
                                backgroundColor: null
                            }
                        });
                        scopeProxied.find(".async-upload-file-input").each(function () {
                            initializeUpload($(this));
                        });
                        window.onbeforeunload = function (e) {
                            var hasActiveUploads = false;
                            scopeProxied.find("[data-upload-accept-file-types]").each(function () {
                                if ($(this).data("upload-isactive") == true) {
                                    hasActiveUploads = true;
                                    return false;
                                }
                            });
                            if (hasActiveUploads)
                                e.returnValue = "There are uploads in progress. These will be aborted if you navigate away.";
                        };
                        scopeProxied.find(".sync-upload-input").on("change", function (e) {
                            unblockIfComplete();
                        });
                        unblockIfComplete();
                    }
                    scopeProxied.find("[data-prompt]").on("change", function (e) {
                        var sender = $(e.currentTarget);
                        if (!confirm(sender.data("prompt"))) {
                            sender.val("");
                        }
                    });
                }
                CloudVideoEdit.initializeUploadProxied = initializeUploadProxied;
            })(CloudVideoEdit = MediaServices.CloudVideoEdit || (MediaServices.CloudVideoEdit = {}));
        })(MediaServices = Azure.MediaServices || (Azure.MediaServices = {}));
    })(Azure = Orchard.Azure || (Orchard.Azure = {}));
})(Orchard || (Orchard = {}));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsb3VkbWVkaWEtZWRpdC1jbG91ZHZpZGVvcGFydC1wcm94aWVkLnRzIl0sIm5hbWVzIjpbIk9yY2hhcmQiLCJPcmNoYXJkLkF6dXJlIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0IiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LmdldEFsbEZpbGVzQ29tcGxldGVkIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LnVuYmxvY2tJZkNvbXBsZXRlIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LnVwbG9hZENvbXBsZXRlZCIsIk9yY2hhcmQuQXp1cmUuTWVkaWFTZXJ2aWNlcy5DbG91ZFZpZGVvRWRpdC5pbml0aWFsaXplVXBsb2FkIiwiT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0LmluaXRpYWxpemVVcGxvYWRQcm94aWVkIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBLDRDQUE0QztBQUM1Qyw4Q0FBOEM7QUFFOUMsSUFBTyxPQUFPLENBMkpiO0FBM0pELFdBQU8sT0FBTztJQUFDQSxJQUFBQSxLQUFLQSxDQTJKbkJBO0lBM0pjQSxXQUFBQSxLQUFLQTtRQUFDQyxJQUFBQSxhQUFhQSxDQTJKakNBO1FBM0pvQkEsV0FBQUEsYUFBYUE7WUFBQ0MsSUFBQUEsY0FBY0EsQ0EySmhEQTtZQTNKa0NBLFdBQUFBLGNBQWNBLEVBQUNBLENBQUNBO2dCQUUvQ0MsSUFBSUEsZUFBdUJBLENBQUNBO2dCQUM1QkEsSUFBSUEsT0FBZUEsQ0FBQ0E7Z0JBQ3BCQSxJQUFJQSxtQkFBNEJBLENBQUNBO2dCQUVqQ0E7b0JBQ0lDLElBQUlBLGlCQUFpQkEsR0FBWUEsSUFBSUEsQ0FBQ0E7b0JBRXRDQSxlQUFlQSxDQUFDQSxJQUFJQSxDQUFDQSwyREFBMkRBLENB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LENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBOzRCQUNsQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7d0JBQ25CQSxDQUFDQTtvQkFDTEEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLENBQUNBO2dCQXZEZUwsc0NBQXVCQSwwQkF1RHRDQSxDQUFBQTtZQUNMQSxDQUFDQSxFQTNKa0NELGNBQWNBLEdBQWRBLDRCQUFjQSxLQUFkQSw0QkFBY0EsUUEySmhEQTtRQUFEQSxDQUFDQSxFQTNKb0JELGFBQWFBLEdBQWJBLG1CQUFhQSxLQUFiQSxtQkFBYUEsUUEySmpDQTtJQUFEQSxDQUFDQSxFQTNKY0QsS0FBS0EsR0FBTEEsYUFBS0EsS0FBTEEsYUFBS0EsUUEySm5CQTtBQUFEQSxDQUFDQSxFQTNKTSxPQUFPLEtBQVAsT0FBTyxRQTJKYiIsImZpbGUiOiJjbG91ZG1lZGlhLWVkaXQtY2xvdWR2aWRlb3BhcnQtcHJveGllZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJUeXBpbmdzL2pxdWVyeS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIlR5cGluZ3MvanF1ZXJ5dWkuZC50c1wiIC8+XHJcblxyXG5tb2R1bGUgT3JjaGFyZC5BenVyZS5NZWRpYVNlcnZpY2VzLkNsb3VkVmlkZW9FZGl0IHtcclxuXHJcbiAgICB2YXIgcmVxdWlyZWRVcGxvYWRzOiBKUXVlcnk7XHJcbiAgICB2YXIgYmxvY2tlZDogSlF1ZXJ5O1xyXG4gICAgdmFyIGhhc1JlcXVpcmVkVXBsb2Fkc3A6IGJvb2xlYW47XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0QWxsRmlsZXNDb21wbGV0ZWQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgdmFyIGFsbEZpbGVzQ29tcGxldGVkOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgcmVxdWlyZWRVcGxvYWRzLmZpbmQoXCJpbnB1dFtuYW1lJD0nLk9yaWdpbmFsRmlsZU5hbWUnXSwgaW5wdXQuc3luYy11cGxvYWQtaW5wdXRcIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLnZhbCgpID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGFsbEZpbGVzQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGFsbEZpbGVzQ29tcGxldGVkO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiB1bmJsb2NrSWZDb21wbGV0ZSgpIHtcclxuICAgICAgICBpZiAoZ2V0QWxsRmlsZXNDb21wbGV0ZWQoKSlcclxuICAgICAgICAgICAgKDxhbnk+YmxvY2tlZCkudW5ibG9jaygpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHVwbG9hZENvbXBsZXRlZChzZW5kZXI6IGFueSwgZGF0YTogYW55KSB7XHJcbiAgICAgICAgdmFyIHNjb3BlID0gJChzZW5kZXIpLmNsb3Nlc3QoXCJbZGF0YS11cGxvYWQtYWNjZXB0LWZpbGUtdHlwZXNdXCIpO1xyXG4gICAgICAgIHZhciBzdGF0dXMgPSBkYXRhLmVycm9yVGhyb3duICYmIGRhdGEuZXJyb3JUaHJvd24ubGVuZ3RoID4gMCA/IGRhdGEuZXJyb3JUaHJvd24gOiBkYXRhLnRleHRTdGF0dXM7XHJcbiAgICAgICAgc2NvcGUuZmluZChcIi5wcm9ncmVzcy1iYXJcIikuaGlkZSgpO1xyXG4gICAgICAgIHNjb3BlLmZpbmQoXCIucHJvZ3Jlc3MtdGV4dFwiKS5oaWRlKCk7XHJcbiAgICAgICAgc2NvcGUuZmluZChcIi5jYW5jZWwtdXBsb2FkXCIpLmhpZGUoKTtcclxuICAgICAgICBzY29wZS5kYXRhKFwidXBsb2FkLWlzYWN0aXZlXCIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChzdGF0dXMpIHtcclxuICAgICAgICAgICAgY2FzZSBcImVycm9yXCI6XHJcbiAgICAgICAgICAgICAgICBhbGVydChcIlRoZSB1cGxvYWQgb2YgdGhlIHNlbGVjdGVkIGZpbGUgZmFpbGVkLiBPbmUgcG9zc2libGUgY2F1c2UgaXMgdGhhdCB0aGUgZmlsZSBzaXplIGV4Y2VlZHMgdGhlIGNvbmZpZ3VyZWQgbWF4UmVxdWVzdExlbmd0aCBzZXR0aW5nIChzZWU6IGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9zeXN0ZW0ud2ViLmNvbmZpZ3VyYXRpb24uaHR0cHJ1bnRpbWVzZWN0aW9uLm1heHJlcXVlc3RsZW5ndGgodj12cy4xMTApLmFzcHgpLiBBbHNvIG1ha2Ugc3VyZSB0aGUgZXhlY3V0aW9uVGltZU91dCBpcyBzZXQgdG8gYWxsb3cgZm9yIGVub3VnaCB0aW1lIGZvciB0aGUgcmVxdWVzdCB0byBleGVjdXRlIHdoZW4gZGVidWc9XFxcImZhbHNlXFxcIi5cIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGNhc2UgXCJhYm9ydFwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHRlbXBvcmFyeUZpbGVOYW1lID0gZGF0YS5yZXN1bHQudGVtcG9yYXJ5RmlsZU5hbWU7XHJcbiAgICAgICAgdmFyIG9yaWdpbmFsRmlsZU5hbWUgPSBkYXRhLnJlc3VsdC5vcmlnaW5hbEZpbGVOYW1lO1xyXG4gICAgICAgIHZhciBmaWxlU2l6ZSA9IGRhdGEucmVzdWx0LmZpbGVTaXplO1xyXG5cclxuICAgICAgICBzY29wZS5maW5kKFwiaW5wdXRbbmFtZSQ9Jy5PcmlnaW5hbEZpbGVOYW1lJ11cIikudmFsKG9yaWdpbmFsRmlsZU5hbWUpO1xyXG4gICAgICAgIHNjb3BlLmZpbmQoXCJpbnB1dFtuYW1lJD0nLlRlbXBvcmFyeUZpbGVOYW1lJ11cIikudmFsKHRlbXBvcmFyeUZpbGVOYW1lKTtcclxuICAgICAgICBzY29wZS5maW5kKFwiaW5wdXRbbmFtZSQ9Jy5GaWxlU2l6ZSddXCIpLnZhbChmaWxlU2l6ZSk7XHJcblxyXG4gICAgICAgIHVuYmxvY2tJZkNvbXBsZXRlKCk7XHJcbiAgICAgICAgJChzZW5kZXIpLnJlcGxhY2VXaXRoKFwiPHNwYW4+U3VjY2Vzc2Z1bGx5IHVwbG9hZGVkIHZpZGVvIGZpbGUgJ1wiICsgb3JpZ2luYWxGaWxlTmFtZSArIFwiJy48L3NwYW4+XCIpO1xyXG4gICAgfVxyXG4gICAgIFxyXG4gICAgZnVuY3Rpb24gaW5pdGlhbGl6ZVVwbG9hZChmaWxlSW5wdXQ6IGFueSkge1xyXG4gICAgICAgIHZhciBzY29wZSA9ICQoZmlsZUlucHV0KS5jbG9zZXN0KFwiW2RhdGEtdXBsb2FkLWFjY2VwdC1maWxlLXR5cGVzXVwiKTtcclxuICAgICAgICB2YXIgYWNjZXB0RmlsZVR5cGVzOiBzdHJpbmcgPSBzY29wZS5kYXRhKFwidXBsb2FkLWFjY2VwdC1maWxlLXR5cGVzXCIpO1xyXG4gICAgICAgIHZhciBhbnRpRm9yZ2VyeVRva2VuID0gcmVxdWlyZWRVcGxvYWRzLmNsb3Nlc3QoXCJmb3JtXCIpLmZpbmQoXCJbbmFtZT0nX19SZXF1ZXN0VmVyaWZpY2F0aW9uVG9rZW4nXVwiKS52YWwoKTtcclxuICAgICAgICB2YXIgY2FuY2VsVXBsb2FkID0gc2NvcGUuZmluZChcIi5jYW5jZWwtdXBsb2FkXCIpO1xyXG5cclxuICAgICAgICBmaWxlSW5wdXQuZmlsZXVwbG9hZCh7XHJcbiAgICAgICAgICAgIGF1dG9VcGxvYWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBhY2NlcHRGaWxlVHlwZXM6IG5ldyBSZWdFeHAoYWNjZXB0RmlsZVR5cGVzLCBcImlcIiksXHJcbiAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICB1cmw6IHNjb3BlLmRhdGEoXCJ1cGxvYWQtZmFsbGJhY2stdXJsXCIpLFxyXG4gICAgICAgICAgICBmb3JtRGF0YToge1xyXG4gICAgICAgICAgICAgICAgX19SZXF1ZXN0VmVyaWZpY2F0aW9uVG9rZW46IGFudGlGb3JnZXJ5VG9rZW5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcHJvZ3Jlc3NhbGw6IChlOiBhbnksIGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBlcmNlbnRDb21wbGV0ZSA9IE1hdGguZmxvb3IoKGRhdGEubG9hZGVkIC8gZGF0YS50b3RhbCkgKiAxMDApO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZmluZChcIi5wcm9ncmVzcy1iYXJcIikuc2hvdygpLmZpbmQoJy5wcm9ncmVzcycpLmNzcygnd2lkdGgnLCBwZXJjZW50Q29tcGxldGUgKyAnJScpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZmluZChcIi5wcm9ncmVzcy10ZXh0XCIpLnNob3coKS50ZXh0KFwiVXBsb2FkaW5nIChcIiArIHBlcmNlbnRDb21wbGV0ZSArIFwiJSkuLi5cIik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGRvbmU6IGZ1bmN0aW9uIChlOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkQ29tcGxldGVkKHRoaXMsIGRhdGEpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmYWlsOiBmdW5jdGlvbiAoZTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIHVwbG9hZENvbXBsZXRlZCh0aGlzLCBkYXRhKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcHJvY2Vzc2RvbmU6IChlOiBhbnksIGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZmluZChcIi52YWxpZGF0aW9uLXRleHRcIikuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZGF0YShcInVwbG9hZC1pc2FjdGl2ZVwiLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGNhbmNlbFVwbG9hZC5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeGhyID0gZGF0YS5zdWJtaXQoKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmRhdGEoXCJ4aHJcIiwgeGhyKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcHJvY2Vzc2ZhaWw6IChlOiBhbnksIGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZmluZChcIi52YWxpZGF0aW9uLXRleHRcIikuc2hvdygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNhbmNlbFVwbG9hZC5vbihcImNsaWNrXCIsIGUgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoY29uZmlybShcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjYW5jZWwgdGhpcyB1cGxvYWQ/XCIpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeGhyID0gc2NvcGUuZGF0YShcInhoclwiKTtcclxuICAgICAgICAgICAgICAgIHhoci5hYm9ydCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVVcGxvYWRQcm94aWVkKCkge1xyXG4gICAgICAgIHZhciBzY29wZVByb3hpZWQgPSAkKFwiLnVwbG9hZC1wcm94aWVkXCIpLnNob3coKTtcclxuICAgICAgICByZXF1aXJlZFVwbG9hZHMgPSBzY29wZVByb3hpZWQuZmluZChcIi5yZXF1aXJlZC11cGxvYWRzLWdyb3VwXCIpO1xyXG4gICAgICAgIGJsb2NrZWQgPSBzY29wZVByb3hpZWQuZmluZChcIi5lZGl0LWl0ZW0tc2lkZWJhclwiKTtcclxuICAgICAgICBoYXNSZXF1aXJlZFVwbG9hZHNwID0gcmVxdWlyZWRVcGxvYWRzLmxlbmd0aCA+IDA7XHJcblxyXG4gICAgICAgIGlmIChoYXNSZXF1aXJlZFVwbG9hZHNwKSB7XHJcbiAgICAgICAgICAgICg8YW55PmJsb2NrZWQpLmJsb2NrKHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlcXVpcmVkVXBsb2Fkcy5kYXRhKFwiYmxvY2stZGVzY3JpcHRpb25cIiksXHJcbiAgICAgICAgICAgICAgICBvdmVybGF5Q1NTOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcIiNmZmZcIixcclxuICAgICAgICAgICAgICAgICAgICBjdXJzb3I6IFwiZGVmYXVsdFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY3NzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiBcImRlZmF1bHRcIixcclxuICAgICAgICAgICAgICAgICAgICBib3JkZXI6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogMCxcclxuICAgICAgICAgICAgICAgICAgICBtYXJnaW46IFwiMzBweCAwIDAgMFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogbnVsbFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlUHJveGllZC5maW5kKFwiLmFzeW5jLXVwbG9hZC1maWxlLWlucHV0XCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaW5pdGlhbGl6ZVVwbG9hZCgkKHRoaXMpKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB3aW5kb3cub25iZWZvcmV1bmxvYWQgPSBlID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBoYXNBY3RpdmVVcGxvYWRzID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGVQcm94aWVkLmZpbmQoXCJbZGF0YS11cGxvYWQtYWNjZXB0LWZpbGUtdHlwZXNdXCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmRhdGEoXCJ1cGxvYWQtaXNhY3RpdmVcIikgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNBY3RpdmVVcGxvYWRzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChoYXNBY3RpdmVVcGxvYWRzKVxyXG4gICAgICAgICAgICAgICAgICAgIGUucmV0dXJuVmFsdWUgPSBcIlRoZXJlIGFyZSB1cGxvYWRzIGluIHByb2dyZXNzLiBUaGVzZSB3aWxsIGJlIGFib3J0ZWQgaWYgeW91IG5hdmlnYXRlIGF3YXkuXCI7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzY29wZVByb3hpZWQuZmluZChcIi5zeW5jLXVwbG9hZC1pbnB1dFwiKS5vbihcImNoYW5nZVwiLCBlPT4ge1xyXG4gICAgICAgICAgICAgICAgdW5ibG9ja0lmQ29tcGxldGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB1bmJsb2NrSWZDb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2NvcGVQcm94aWVkLmZpbmQoXCJbZGF0YS1wcm9tcHRdXCIpLm9uKFwiY2hhbmdlXCIsIGUgPT4ge1xyXG4gICAgICAgICAgICB2YXIgc2VuZGVyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKCFjb25maXJtKHNlbmRlci5kYXRhKFwicHJvbXB0XCIpKSkge1xyXG4gICAgICAgICAgICAgICAgc2VuZGVyLnZhbChcIlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59Il19
